package xss

import (
	"html"
	"regexp"
	"net/http"
)

type Data struct{
	Name string
}
func New()Data{
	return Data{
		Name:"",
	}
}
func (d *Data) UnEscapeString(name string){
	d.Name = name
}

func (d *Data) EscapeString(name string){
	filter := regexp.MustCompile("<[^>]*>")
	replace := ""
	finalString := filter.ReplaceAllString(name,replace)
	d.Name = html.EscapeString(finalString)
}

//cros site scripting
func GetNameHandler(w http.ResponseWriter, r *http.Request) {
	name := r.FormValue("name")
	data := xss.New()
	if !util.CheckLevel(r) { //if level == low
		data.UnEscapeString(name)
	} else {
		data.EscapeString(name)
	}
	fmt.Println(data.Name)

	param := make(map[string]interface{})
	param["name"] = template.HTML(name)

	util.UnSafeRender(w, "template.xss", param)
}